Firebase Storage Security Rules

Copy and paste these rules into your Firebase Console:
1. Go to Firebase Console → Storage → Rules
2. Replace the existing rules with the rules below
3. Click "Publish"

===========================================
RULES:
===========================================

rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Allow public read access to input files (for Replicate API)
    // This allows Replicate to access uploaded images without authentication
    // Input files are temporary and used once for video generation
    match /users/{userId}/inputs/{fileName} {
      allow read: if true;  // Public read for Replicate
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Keep other user files private
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Optional: Allow read access to public files (if needed)
    match /public/{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null;
    }
  }
}

===========================================
EXPLANATION:
===========================================

- `users/{userId}/inputs/{fileName}` - Input files for video generation
  - ✅ Public read access (allows Replicate API to access images)
  - ✅ Only authenticated users can write to their own inputs folder
  - ⚠️ These files are temporary and used once for generation

- `users/{userId}/{allPaths=**}` - All other user files (private)
  This includes:
  - users/{userId}/effects/*.jpeg (if you add effects later)
  - users/{userId}/videos/* (generated videos)
  - Any other files under the user's directory
  - ✅ Requires authentication to read/write
  - ✅ Users can only access their own files

- `public/{allPaths=**}` - Public files (if needed)
  - ✅ Anyone can read
  - ✅ Only authenticated users can write

Security:
✅ Input files are publicly readable (needed for Replicate API)
✅ All other user files remain private
✅ Users can only write to their own directories
✅ Unauthenticated users cannot upload files

===========================================
ALTERNATIVE (More Permissive - for testing):
===========================================

If you want to test quickly (NOT for production):

rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}

This allows any authenticated user to read/write anywhere.
Use only for testing!

